<html>
  <head>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <script src="https://unpkg.com/openchemlib@7.4.1/dist/openchemlib-full.js"></script>

    <py-env>
      - nx
# non-pure wheel     - https://files.pythonhosted.org/packages/60/d0/d7e0dacb4f57d76b48f226dff89006afec394e96b8092ec8fd777b18e836/igraph-0.9.11-pp39-pypy39_pp73-manylinux_2_17_x86_64.manylinux2014_x86_64.whl
      - TUCAN/dist/tucan-0.1.0-py2.py3-none-any.whl
    </py-env>
  </head>
  <body onload="startEditor()">
    <script type="text/javascript">
      var editor;

      function startEditor() {
        editor = window.OCL.StructureEditor.createSVGEditor("editor", 1);
      }

      function getMolfileFromEditor() {
        let origMol = editor.getMolecule();
        let molecule = new OCL.Molecule(origMol.getAllAtoms(), origMol.getAllBonds());
        origMol.copyMolecule(molecule);
        molecule.addImplicitHydrogens();
        return molecule.toMolfileV3();
      }
    </script>

    <py-script>
      from tucan.canonicalization import canonicalize_molecule
      from tucan.serialization import serialize_molecule
      from tucan.io import _parse_molfile3000, graph_from_moldata
      import networkx as nx

      from pyodide import create_proxy
      import js

      def graph_from_molfile(molfile: str) -> nx.Graph:
        element_symbols, bonds = _parse_molfile3000(molfile)
        return graph_from_moldata(element_symbols, bonds)

      def serialize(m):
        return serialize_molecule(canonicalize_molecule(m))

      def molfile_to_tucan():
        document.getElementById("text").innerHTML = ""

        molfile = js.getMolfileFromEditor()
        graph = graph_from_molfile(molfile)

        if list(graph.edges):
          document.getElementById("text").innerHTML = serialize(graph)

      def click_button(event):
        molfile_to_tucan()

      def setup():
        click_proxy = create_proxy(click_button)
        document.getElementById("button").addEventListener("click", click_proxy)

      setup()
    </py-script>

    <div id="editor" style="width:400px;height:400px;border:solid;border-width:1px;"></div>
    <button id="button" type="button">Convert molecule to TUCAN</button>
    <pre id="text" style="white-space: pre-wrap;"></pre>
  </body>
</html>